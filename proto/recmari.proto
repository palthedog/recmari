syntax = "proto3";
package recmari;

// A single match (first-to-2 rounds). The basic unit of analysis.
message Match {
  // Source information for this match.
  SourceMetadata source = 1;
  // Rounds in this match (chr`onological order, typically 2-3).
  repeated Round rounds = 2;
}

// Where the match was extracted from.
message SourceMetadata {
  oneof source {
    // Analysis from a recorded video file.
    VideoFileSource video_file = 1;
    // Analysis from real-time screen capture (future).
    ScreenCaptureSource screen_capture = 2;
  }
}

message VideoFileSource {
  // Path to the video file (e.g. "C:/replays/session01.mp4").
  string file_path = 1;
  // Seconds into the video where this match starts (e.g. 3 minutes in -> 180.0).
  double start_seconds = 2;
}

message ScreenCaptureSource {
  // Timestamp when capture started (RFC 3339, e.g. "2026-02-20T21:30:00+09:00").
  string captured_at = 1;
}

// A single round â€” one fight until KO or time-up.
message Round {
  // Round number within the match (0-based).
  uint32 round_index = 1;
  // Sampled frame data during this round (chronological order).
  repeated FrameData frames = 2;
}

// Game state extracted from a single frame.
message FrameData {
  // Absolute frame number within the source (0-based, counted from the start of the video).
  uint32 frame_number = 1;
  // Elapsed seconds from the start of the source (e.g. frame 120 @ 60fps -> 2.0).
  double timestamp_seconds = 2;
  // Player 1 (left side) state.
  PlayerState player1 = 3;
  // Player 2 (right side) state.
  PlayerState player2 = 4;
}

// Per-player state for a single frame.
message PlayerState {
  // Remaining health ratio. 1.0 = full, 0.0 = KO.
  // Computed from HP bar fill ratio via HSV color analysis.
  optional double health_ratio = 1;

  // SA (Super Art) gauge value. 0.0 = empty, 3.0 = full.
  // Computed from stock count (digit display) + gauge bar fill ratio.
  optional double sa_gauge = 2;

  // OD (Drive) gauge value. 0.0 = empty, 6.0 = full.
  // Absent during burnout.
  optional double od_gauge = 3;

  // Burnout recovery gauge. 0.0 = just entered burnout, 1.0 = fully recovered.
  // Absent when not in burnout.
  optional double burnout_gauge = 4;
}
